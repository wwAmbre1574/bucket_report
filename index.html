<!DOCTYPE html>
<html>
<head>
  <title>ğŸ“Š ä¸€éµä¸‹è¼‰ Sentio æ•¸æ“š</title>
</head>
<body>
  <h2>ğŸ“Š Sentio æ•¸æ“šå½™æ•´</h2>
  <button onclick="downloadData()">å–å¾—æœ€æ–° CSV</button>
  <p id="status"></p>

  <script>
    async function downloadData() {
      document.getElementById("status").innerText = "â³ è™•ç†ä¸­...";

      try {
        // è¨­å®š timeoutï¼ˆ10 ç§’ï¼‰
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 600000);

        // ç™¼é€ API è«‹æ±‚
        const res = await fetch("https://tbtclist-production.up.railway.app/export-sentio", {
          method: "GET",
          signal: controller.signal
        });
        
        clearTimeout(timeout); // æ¸…é™¤ timeout è¨ˆæ™‚å™¨

        const result = await res.json();

        if (result.success) {
          const a = document.createElement("a");
          a.href = result.download_url;
          a.download = "sentio_data.csv";
          a.click();
          document.getElementById("status").innerText = "âœ… å·²ä¸‹è¼‰";
        } else {
          document.getElementById("status").innerText = "âŒ éŒ¯èª¤ï¼š" + result.error;
        }

      } catch (error) {
        // è‹¥æœ‰éŒ¯èª¤ï¼ˆä¾‹å¦‚ timeoutã€server downï¼‰
        document.getElementById("status").innerText = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + JSON.stringify(error);
        
        // è£œå……æ›´å¤šéŒ¯èª¤è³‡è¨Š
        console.error("éŒ¯èª¤ç‰©ä»¶:", error);
        alert("éŒ¯èª¤å…§å®¹: " + error.message);
      }
    }
  </script>
</body>
</html>

